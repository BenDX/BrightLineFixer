name: Build BrightLine APK

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        distribution: 'zulu'
        java-version: '17'
        cache: 'gradle'
    
    - name: Build APK
      run: ./gradlew assembleDebug
    
    - name: ğŸ” å°‹æ‰¾æ‰€æœ‰APKæª”æ¡ˆ
      run: |
        echo "=== å°‹æ‰¾æ‰€æœ‰APK ==="
        find . -name "*.apk" -type f || echo "âŒ å®Œå…¨æ²’æ‰¾åˆ°APK"
        echo "=== æª¢æŸ¥app/buildçµæ§‹ ==="
        find app/build -type f -name "*.apk" || echo "âŒ app/buildç„¡APK"
        echo "=== å®Œæ•´buildç›®éŒ„ ==="
        find app/build -type d | head -20
    
    - name: ğŸ“¤ ä¸Šå‚³æ‰€æœ‰æ‰¾åˆ°çš„APK
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: all-apks-found
        path: |
          app/build/**/*.apk
          **/*.apk
        retention-days: 30
